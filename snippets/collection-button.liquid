{% comment %}
    Toggle between "buy it now" and "add to cart" button based on the theme settings
    Functionality: 
    - When buy it now is clicked, the browser is redirected to checkout with the chosen product in the cart
    - When add to cart is clicked, the product is added to the cart, and the browser does not redirect
{% endcomment %}

{%- assign current_variant = product.selected_or_first_available_variant -%}

<div class="product-template__container page-width"
        id="ProductSection-{{ section.id }}"
        data-section-id="{{ section.id }}"
        data-section-type="product"
        data-enable-history-state="true"
        data-ajax-enabled="{{ settings.enable_ajax }}">
    {% form 'product', product, class:form_classes, novalidate: 'novalidate', data-product-form: '' %}
        <select name="id" id="ProductSelect-{{ section.id }}" class="product-form__variants no-js">
            {% for variant in product.variants %}
            <option value="{{ variant.id }}" {%- if variant == current_variant %} selected="selected" {%- endif -%}>
                {{ variant.title }}  {%- if variant.available == false %} - {{ 'products.product.sold_out' | t }}{% endif %}
            </option>
            {% endfor %}
        </select>
        <div class="product-form__error-message-wrapper product-form__error-message-wrapper--hidden{% if section.settings.enable_payment_button %} product-form__error-message-wrapper--has-payment-button{% endif %}"
            data-error-message-wrapper
            role="alert">
            <span class="visually-hidden">{{ 'general.accessibility.error' | t }} </span>
            {% include 'icon-error' %}
            <span class="product-form__error-message" data-error-message>{{ 'products.product.quantity_minimum_message' | t }}</span>
        </div>
        <div class="product-form__controls-group product-form__controls-group--submit">
            <div class="product-form__item product-form__item--submit" >
                {% if settings.add_to_cart_change %}
                    <button type="submit" name="add"
                        {% unless current_variant.available %} aria-disabled="true"{% endunless %}
                        aria-label="{% unless current_variant.available %}{{ 'products.product.sold_out' | t }}{% else %}{{ 'products.product.add_to_cart' | t }}{% endunless %}"
                        class="btn product-form__cart-submit"
                        {% if settings.enable_ajax %}aria-haspopup="dialog"{% endif %}
                        data-add-to-cart>
                        <span data-add-to-cart-text>
                            {{ 'products.product.add_to_cart' | t }}
                        </span>
                        <span class="hide" data-loader>
                            {% include 'icon-spinner' %}
                        </span>
                    </button>
                {% else %}
                    {% unless current_variant.available %}
                        <button aria-disabled="true" class="btn product-form__cart-submit">BUY IT NOW</button>
                    {% else %}
                        {{ form | payment_button }}
                    {% endunless %}
                {% endif %}
            </div>
        </div>
    {% endform %}
</div>

<script type="application/json" id="ProductJson-{{ section.id }}">
    {{ product | json }}
</script>
